# 🚀发票识别助手上线！一键批量解析发票，导出 Excel + 写入数据库，全自动！

> 📍作者：@Stream Wang
> 
> 
> 🔗项目：Dify Workflow + Python 脚本
> 
> 🧰关键词：发票OCR、自动化处理、批量识别、PDF转图、数据库写入、PyInstaller打包
> 

---

随着AI和自动化的结合愈发紧密，面对大量发票的人工录入和核对工作，是不是感觉异常枯燥？今天就为大家带来一款实用性极强的开源工具 —— **发票识别助手**！

你只需上传发票 PDF，一键即可实现：

- 🧠 发票信息结构化识别（OCR + LLM）
- 📊 批量导出 Excel 表格
- 🏦 同步写入数据库（MySQL）
- 💡 打包为可执行文件，方便部署运行

下面我们一起看看这个项目是如何构建的吧！

## 📎项目开源地址（可填写）

👉 GitHub：https://github.com/StreamWangiiiiii/InvoicePDFIdentify.git

---

## 📌一、项目简介：发票识别自动化全流程

### ✅ 总体流程概览：

1. 用户上传 PDF 发票
2. 将 PDF 转换为图片（使用 `pdf_process` 插件）
3. 图片交给大模型进行关键信息提取（使用 `Qwen2.5-VL-72B-Instruct` 模型）
4. 解析并标准化结构化信息
5. 保存为 Excel + 写入数据库

📎 本项目分为：

- Dify Workflow：构建了自动化识别流程
- Python 脚本：实现批量处理、保存和数据库写入
- 代码打包，数据库脚本

---

## ⚙️二、Dify Workflow （发票识别助手.yml）

基于 [Dify](https://dify.ai/) 创建了一个名为 **发票识别助手** 的工作流。下面是核心模块一览：

从0到1的配置请参考 h[ttps://mp.weixin.qq.com/s/ceKnzAbx_CL6BPWwyNDNPA](https://mp.weixin.qq.com/s/ceKnzAbx_CL6BPWwyNDNPA)

### 🔧 输入模块（Start Node）

- 变量名：`upload`
- 文件类型：支持 PDF、图片格式
- 上传数量：最多支持 5 个文件批量处理

### 🔄 文件类型判断

- 如果是图片：直接送入 LLM 提取发票字段
- 如果是 PDF：先使用 **PDF转PNG工具** 转换为图像，再送入 LLM

### 🧠 LLM 识别模块

模型选用带视觉的Qwen/Qwen2.5-VL-72B-Instruct

## 三、Python 批量处理脚本（`batch_invoicePDF.py`）

Dify 导出的 JSON 信息非常标准，我们编写了一个 Python 脚本来实现后处理：

### ✅ 脚本核心功能：

1. 将 JSON 数据写入 Excel 文件（支持多个发票合并导出）
2. 将数据入库保存（MySQL 支持）
3. 支持命令行运行，适配批处理任务

---

## 四、数据库脚本（DatabaseCreation.sql）

## 五、程序打包（pack.spec）

在终端进入代码所在目录，执行   `pyinstaller --clean pack.spec`

打包完成后，会生成以下文件 / 目录：

- `dist/`：包含可执行文件（`InvoiceProcessor`，macOS 下是可执行程序，Windows 下是 `.exe`）。
- `build/`：临时文件（可删除）。
- `pack.spec`：配置文件（保留，下次可直接使用）。

---

## ✍️六、总结与心得

结合 **大模型 + 文档处理 + 后端编程** 的实战：

- ✅ Dify 的 Workflow 模型逻辑图形化，非常适合低门槛集成AI能力
- ✅ LLM 的 JSON 输出控制力很关键，prompt需严格规范
- ✅ 批处理+结构化输出+数据库操作组合实用性很强

挑战：

- **JSON 解析**：在处理 LLM 输出的 JSON 数据时，可能会遇到格式错误的问题，需要进行严格的错误处理。
- **数据清洗**：发票数据中可能包含各种格式的日期、金额等信息，需要进行统一的格式处理，以确保数据的一致性。
- **性能优化**：在处理大量发票数据时，需要考虑性能问题，如使用并发处理、优化数据库操作等。
- **模型优化及控制**：不同模型对发票的识别结果准确性不同（比如使用gemini 2.5幻觉问题），需要对数据准确性进行监督。

## 最后

通过使用 Dify 构建发票识别助手 Workflow，并编写批量处理脚本，实现了发票信息的自动识别、处理和存储，大大提高了工作效率。同时，开源分享相关代码也希望能为其他开发者提供一些参考和帮助。

希望这篇博客对你有所帮助，如果你有任何问题或建议，欢迎在评论区留言。

以上博客内容仅供参考，你可以根据实际情况进行调整和修改。如果你在开发过程中有更多的细节或经验，也可以加入到博客中，使内容更加丰富和有价值。
